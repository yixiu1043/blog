---
title: 操作系统
date: 2022-11-1
tags:
  - 网课
category: 计算机
banner: /blog/img/banner/62.jpeg
---

# 操作系统



## 第一章

### 操作系统的概念

用户

&darr;

应用程序

&darr;

操组系统

&darr;

裸机（纯硬件）



1. 负责管理协调硬件、软件等计算机资源的工作
2. 为上层的应用程序、用户提供简单易用的服务
3. 操作系统时系统软件，而不是硬件



#### 操作系统的定义

操作系统是指控制和管理整个计算机系统的硬件和软件资源，并合理的组织调度计算机的工作和资源的分配，以提供给用户和其他软件方便的接口和环境，它是计算机系统中最基本的系统软件。



#### 操作系统的功能

##### 作为系统资源的管理者

功能：

- 处理机管理
- 存储器管理
- 文件管理
- 设备管理

目标：安全、高效



##### 作为用户和计算机硬件之间的接口

功能：

- 命令接口

  允许用户直接使用

  - 联机命令接口

    用户说一句，系统做一句

  - 脱机命令接口

    用户说一堆，系统做一堆

- 程序接口

  允许用户通过程序间接使用

  由一组系统调用组成，程序接口 = 系统调用

- GUI（图形用户界面）

  用户可以使用形象的图形界面进行操作，而不需要记忆复杂的命令、参数

目标：方便用户使用



易懵概念：

系统调用 = 系统调用命令 = 广义指令



##### 作为最接近硬件的层次

需要提供的功能和目标：实现对硬件机器的拓展

没有任何软件支持的计算机称为裸机

通常把覆盖了软件的机器称为扩充机器，又称为虚拟机



### 操作系统的特征

#### 并发

指两个或多个事件在同一时间间隔内发生，这些事件宏观上是同时发生的，但微观上是交替发生的，操作系统的并发性指计算机系统中同时存在着多个运行着的程序。

一个单核处理机（CPU）同一时刻只能执行一个程序，因此操作系统会负责协调多个程序交替执行（这些程序微观上是交替执行的，但宏观上看起来就像在同时执行）。

事实上，操作系统就是伴随着“多道程序技术”而出现的。因此，操作系统和程序并发是一起诞生的。



#### 共享

共享即资源共享，是指系统中的资源可供内存中多个并发执行的进程共同使用。

- 互斥共享

  系统中的某些资源，虽然可以提供给多个进程使用，但一个时间段内只允许一个进程访问该资源。

- 同时共享方式

  系统中的某些资源，允许一个时间段内由多个进程“同时”对它们进行访问。

所谓“同时”往往上宏观上的，而在微观上，这些进程可能是交替的对该资源进行访问的（即分时共享）。



#### 并发和共享的关系

并发性是指计算机系统中同时存在着多个运行着的程序。

共享性是指系统中的资源可供内存中多个并发执行的进程同时使用。



如果失去并发性，则系统中只有一个程序正在运行，则共享性失去存在的意义。

如果失去共享性，则QQ和微信不能同时访问硬盘资源，就无法实现同时发送文件，也就无法并发。

并发性和共享性护卫存在条件



#### 虚拟

虚拟是指把一个物理上的实体变为若干个逻辑上的对应物。物理实体（前者）是实际存在的，而逻辑上对应物（后者）是用户感受到的。

- 空分复用技术（如虚拟存储器技术）
- 时分复用技术（如虚拟处理器）

显然，如果失去了并发性，则一个时间段内系统中只需运行一道程序，那么就失去了实现虚拟性的意义了。因此，没有并发性，就谈不上虚拟性。



#### 异步

异步是指，在多道程序环境下，允许多个程序并发执行，但由于资源有限，进程的执行不是一贯到底的，而是走走停停，以不可预知的速度向前推进，这就是进程的异步性。



### 操作系统的发展与分类

#### 手工操作阶段

利用纸带打孔技术

主要缺点：用户独占全机、人机速度矛盾导致资源利用率极低。



#### 单道批处理系统

引入脱机输入/输出技术（用磁带完成），并监督程序负责控制作业的输入、输出

优点：缓解了一定程度的人机速度矛盾，资源利用率有所提升。

缺点：内存中仅能有一道程序运行，只有该程序运行结束之后才能调入下一道程序。CPU有大量的时间是在空闲等待I/O完成。资源利用率依然很低。



#### 多道批处理系统

每次往内存中输入多道程序，由操作系统负责管理这些程序的运行，各个程序并发执行。

优点：多道程序并发执行，共享计算机资源。资源利用率大幅提升，CPU和其他资源保持“忙碌”状态，系统吞吐量增大。

缺点：用户响应时间长，没有人机交互功能（用户提交自己的作业之后就只能等待计算机处理完成，中间不能控制自己的作业执行）



#### 分时操作系统

计算机以时间片为单位轮流为各个用户/作业服务，各个用户可通过终端与计算机进行交互。

优点：用户请求可以被即时响应，解决了人机交互问题，允许多个用户同时使用一台计算机，并且用户对计算机的操作相互独立，感受不到别人的存在。

缺点：不能优先处理一些紧急任务。操作系统对各个用户/作业都是完全公平的，循环的为每个用户/作业服务一个时间片，不区分任务的紧急性。



#### 实时操作系统

在实时操作系统的控制下，计算机系统接收到外部信号后及时进行处理，并且要在严格的时限内处理完事件。实时操作系统的主要特点是及时性和可靠性。

- 硬实时操作系统

  必须在绝对严格的规定时间内完成处理

- 软实时操作系统

  能接受偶尔违反时间规定

  

优点：能够优先响应一些紧急任务，某些紧急任务不需时间片排队。



#### 其他几种操作系统

网络操作系统：是伴随计算机网络的发展而诞生的，能把网络中各个计算机有机的结合起来，实现数据传送等功能，实现网络中各种资源的共享（如文件夹）和各个计算机之间的通信。（如：Windows NT就是一种典型的网络操作系统，网站服务器就可以使用）

分布式操作系统：主要特点是分布性和并行性。系统中各台计算机地位相同，任何工作都可以分布在这些计算机上，由它们并行、协同完成这个任务。

个人计算机操作系统：如Windows XP、MacOS，方便个人使用。



### 操作系统的运行机制和体系结构

#### 什么是指令

一条高级语言的代码翻译过来可能会对应多条指令。

简单来说，“指令”就是处理器（CPU）能识别、执行的最基本命令，比如说：加法指令就是让CPU进行加法运算。



#### 两种指令

- 特权指令

  内存清零指令，不允许用户程序使用

- 非特权指令

  如普通的运算指令



#### 两种状态

- 用户态（目态）

  此时CPU只能执行非特权指令

- 核心态（管态）

  特权指令、非特权指令都可以执行

用程序状态寄存器（PSW）中的某标志位来标识当前处理器处于什么状态，如0位用户态，1为核心态。



#### 两种程序

- 内核程序

  操作系统的内核程序是系统的管理者，既可以执行特权指令，也可以执行非特权指令，运行在核心态。

- 应用程序

  为了保证系统能安全运行，普通应用程序只能执行非特权指令，运行在用户态。



#### 操作系统的内核

内核是计算机配置的底层软件，是操作系统最基本、最核心的部分。

实现操作系统内核功能的那些程序就是内核程序。

##### 内核程序

- 时间管理
- 中断处理
- 原语
- 资源管理
  - 进程管理
  - 存储器管理
  - 设备管理



##### 体系结构

- 大内核

  将操作系统的主要功能模块都作为系统内核，运行在核心态

  优点：高性能

  缺点：内核代码庞大，结构混乱，难以维护

- 微内核

  只把最基本的功能保留在内核

  优点：内核功能少，结构清晰，方便维护

  缺点：需要频繁的在核心态和用户态之间切换，性能低



### 中断和异常

#### 中断的概念和作用

1. 当中断发生时，CPU立即进入核心态
2. 当中断发生后，当前运行的进程暂停运行，并由操作系统内核对中断进行处理
3. 对于不同的中断信号，会进行不同的处理

发生了中断，意味着需要操作系统介入，开展管理工作。由于操作系统的管理工作（比如进程切换、分配I/O设备等）需要使用特权指令，因此CPU要从用户态转换为核心态。中断可以使CPU从用户态切换为核心态，使操作系统获得计算机控制权。有了中断，才能实现多道程序并发执行。



#### 中断的分类

- 内中断

  也称异常、例外、陷入，信号的来源自CPU内部，与当前执行的指令有关

  - 自愿中断

    - 指令中断

      有意为之的异常，如系统调用时使用的访管指令（又叫陷入指令、trap指令）

  - 强迫中断

    - 硬件故障

      由错误条件引起的，可能被故障处理程序修复，如缺页

    - 软件中断

      不可恢复的致命错误造成的结果，终止处理程序不再将控制返回给引发终止的应用程序，如整数除0

- 外中断

  信号来源自CPU外部与当前执行的指令无关，狭义的中断

  - 外设请求

    如I/O操作完成发出的中断信号

  - 人工干预

    用户强行终止一个进程



#### 中断的处理过程

Step1：执行完每个指令之后，CPU都要检查当前是否有外部中断信号

Step2：如果检测到外部中断信号，则需要保护被中断进程的CPU环境（如程序状态字PSW、程序计数器PC、各种通用寄存器）

Step3：根据中断信号类型转入响应的中断处理程序

Step4：恢复原进程的CPU环境并退出中断，返回原进程继续往下执行



### 系统调用

#### 什么是系统调用，有何作用？

应用程序通过系统调用请求操作系统的服务。系统中的各种共享资源都由操作系统统一掌管，因此在用户程序中，凡是与资源有关的操作（如存储分配、I/O操作、文件管理等），都必须通过系统调用方式向操作系统提出服务请求，由操作系统代为完成。这样可以保证系统的稳定性和安全性，防止用户进行非法操组。

- 设备管理

  完成设备的请求/释放/启动等功能

- 文件管理

  完成文件的读/写/创建/删除等功能

- 进程控制

  完成进程的创建/撤销/阻塞/唤醒等功能

- 进程通信

  完成进程之间的消息传递/信号传递等功能

- 内存管理

  完成内存的分配/回收等功能



系统调用相关处理涉及到对系统资源的管理、对进程的控制，这些功能需要执行一些特权指令才能完成，因此系统调用的相关处理需要在核心态下进行。



#### 系统调用与库函数的区别

| 普通应用程序 | 可直接进行系统调用，也可以使用库函数。有的库函数涉及系统调用，有的不涉及。 |        |
| ------------ | ------------------------------------------------------------ | ------ |
| 编程语言     | 向上提供库函数。有时会将系统调用封装成库函数，以隐藏系统调用的一些细节，使上层进行系统调用更加方便 | &uarr; |
| 操组系统     | 向上提供系统调用                                             | &uarr; |
| 裸机         |                                                              | &uarr; |



#### 系统调用背后的过程

| 高级语言代码                                                 | 编译   | 汇编语言指令                                                 |
| ------------------------------------------------------------ | ------ | ------------------------------------------------------------ |
| 代码1                                                        |        |                                                              |
| 代码2                                                        |        |                                                              |
| 调用库函数write("abc")，该库函数内部封装了系统调用的复杂细节 | &rarr; | 1. 前期处理相关指令<br />2. movl指令（将“abc”作为系统调用参数放到某个通用寄存器中）<br />3.int x指令（trap/陷入/访管指令）<br />4. 后续处理相关指令 |
|                                                              |        |                                                              |
| 代码4                                                        |        |                                                              |
| 指令5                                                        |        |                                                              |
| ...                                                          |        |                                                              |

1. 传递系统调用参数
2. 执行陷入指令（用户态）
3. 执行系统调用相应服务程序（核心态）
4. 返回用户程序



注意：

1. 陷入指令是在用户态执行的，执行陷入指令之后立即引发一个内中断，从而CPU进入核心态
2. 发出系统调用请求是在用户态，而对系统调用的相应处理在核心态下进行
3. 陷入指令是唯一一个只能在用户态执行，而不可在核心态执行的指令



## 第二章

### 进程的定义、组成、组织方式、特征
